<!DOCTYPE html>
<html lang="hu">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Vonaldiagram Mozgóátlaggal</title>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <style>
      body {
         background-color: #cbc7c3;
      }

      table {
         width: 100%;
         border-collapse: collapse;
         max-height: 300px;
         overflow-y: auto;
         display: ruby-text;
      }

      thead {
         position: sticky;
         top: 0;
      }

      th,
      td {
         border: 1px solid #ddd;
         padding: 8px;
      }

      th {
         background-color: #f2f2f2;
         text-align: left;
      }

      .chart-container {
         width: 100%;
      }
   </style>
</head>

<body>
   <div style="padding: 0 0 20px 10px;">
      <a href="index.html"><button>sine curve</button></a>
      <a href="index2.html"><button>x-y diagram</button></a>
   </div>
   <form id="dataForm">
      <div style="padding-block: 10px;"><label for="dataInput1">Data 1 (tab separated):</label></div>
      <div>
         <textarea id="dataInput1" rows="4" cols="30"
            placeholder="-263.8669  -0.3252910&#10;-299.3872  -0.6550498"></textarea>
      </div>
      <div style="padding-block: 10px;"><label for="dataInput2">Data 2 (tab separated):</label></div>
      <div>
         <textarea id="dataInput2" rows="4" cols="30" placeholder="value1  value2"></textarea>
      </div>
      <div style="padding-block: 10px;"><label for="dataInput3">Data 3 (tab separated):</label></div>
      <div>
         <textarea id="dataInput3" rows="4" cols="30" placeholder="value1  value2"></textarea>
      </div>
      <div style="padding:10px 0 5px ;">
         <label for="windowSize">Moving average:</label>
         <input type="number" id="windowSize" value="5" step="1" min="1" style="width: 50px;">
      </div>
      <div style="padding:5px 0 5px ;">
         <label for="yMax">Y-axis max value:</label>
         <input type="number" id="yMax" value="2.5" step="0.1" style="width: 50px;">
      </div>
      <div style="padding:5px 0 5px ;">
         <label for="yMin">Y-axis min value:</label>
         <input type="number" id="yMin" value="-2.5" step="0.1" style="width: 50px;">
      </div>
      <div style="padding:5px 0 10px;">
         <label for="chartHeight">Chart Height (px):</label>
         <input type="number" id="chartHeight" value="800" step="0.1" style="width: 50px;">
      </div>
      <div style="padding:5px 0 10px;">
         <label for="absXValues">Absolute X Values:</label>
         <input type="checkbox" id="absXValues" checked>
      </div>
      <button type="submit" style="font-size: .9rem; padding:5px 15px; margin-left: 10px;">Submit</button>
   </form>
   <br>
   <div class="chart-container">
      <canvas id="myChart"></canvas>
   </div>
   <script>
      let datasets = [];

      document.getElementById('dataForm').addEventListener('submit', function (event) {
         event.preventDefault();
         datasets = [];
         const inputData1 = document.getElementById('dataInput1').value;
         const inputData2 = document.getElementById('dataInput2').value;
         const inputData3 = document.getElementById('dataInput3').value;
         const dataInputs = [inputData1, inputData2, inputData3];
         const colors = ['rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)'];

         dataInputs.forEach((dataInput, index) => {
            const rows = dataInput.trim().split('\n');
            let xData = [];
            let yData = [];
            rows.forEach(row => {
               const [x, y] = row.split('\t').map(Number);
               if (!isNaN(x) && !isNaN(y)) {
                  xData.push(x);
                  yData.push(y);
               }
            });

            if (xData.length > 0 && yData.length > 0) {
               const windowSize = parseInt(document.getElementById('windowSize').value);
               const smoothedXData = calculateMovingAverage(xData, windowSize);
               const smoothedYData = calculateMovingAverage(yData, windowSize);

               const dataset = {
                  label: `Dataset ${index + 1}`,
                  borderColor: colors[index],
                  backgroundColor: colors[index].replace('1)', '0.2)'),
                  fill: false,
                  tension: 0.1,
                  borderWidth: 1,
                  pointRadius: 1,
                  data: smoothedXData.map((x, i) => ({ x: x, y: smoothedYData[i] }))
               };

               datasets.push(dataset);
            }
         });

         if (datasets.length === 0) {
            alert('Nincs érvényes adat!');
            return;
         }

         updateChart();
      });

      function calculateMovingAverage(data, windowSize) {
         let result = [];
         for (let i = 0; i < data.length; i++) {
            let start = Math.max(0, i - Math.floor(windowSize / 2));
            let end = Math.min(data.length, i + Math.floor(windowSize / 2) + 1);
            let window = data.slice(start, end);
            let average = window.reduce((sum, value) => sum + value, 0) / window.length;
            result.push(average);
         }
         return result;
      }

      const config = {
         type: 'line',
         data: {
            datasets: []
         },
         options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
               x: {
                  type: 'linear',
                  display: true,
                  title: {
                     display: true,
                     text: 'X-axis value'
                  }
               },
               y: {
                  display: true,
                  title: {
                     display: true,
                     text: 'Y-axis value'
                  },
                  min: -2.5,
                  max: 2.5
               }
            }
         }
      };

      let chart;
      function updateChart() {
         const absXValues = document.getElementById('absXValues').checked;

         datasets.forEach(dataset => {
            if (absXValues) {
               dataset.data.forEach(d => d.x = Math.abs(d.x));
            }
         });

         config.data.datasets = datasets;

         const yMin = parseFloat(document.getElementById('yMin').value);
         const yMax = parseFloat(document.getElementById('yMax').value);
         const chartHeight = parseInt(document.getElementById('chartHeight').value);

         config.options.scales.y.min = yMin;
         config.options.scales.y.max = yMax;

         if (chart) {
            chart.destroy();
         }
         const ctx = document.getElementById('myChart').getContext('2d');
         ctx.canvas.parentNode.style.height = `${chartHeight}px`;
         chart = new Chart(ctx, config);
      }
   </script>
</body>

</html>